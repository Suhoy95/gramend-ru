# 20220805 Поиск дубликатов файлов с помощью Shell-команд

Перебираясь с одного компьютера на другой, чтобы все нужные и важные файлы не
потерялись на разных устройствах, Я начал использовать Облачный диск плюс
внешний жесткий диск, как дубликат облака. Но в один прекрасный момент, жесткого
диска на 1 ТБайт стало не хватать, и  пришлось перебираться на жесткий диск
побольше.

После синхронизации на новый жесткий диск, встал вопрос освободить предыдущий
внешний жесткий диск с данным, который хранился как резерв. Теперь, перед
тем как удалить с него файлы и отформатировать, хочется проверить, что файлы
точно присутствуют на новом жестком диске.

Заодно, хочется иметь метод, проверки, что файлы уже присутствуют на диске.
Начнем!!!

## Создание списка Файлов с Контрольными Суммами

Чтобы проверить, что файл уже существует на диске мы создадим список существующих
файлов. И у каждого файла вычислим их размер и контрольную сумму - этого будет
более чем достаточно, чтобы убедится что файлы одинаковы.

1. Список файлов мы получим с помощью команды `find`:

```bash
find . -type f -print > ~/files_list.txt
```

- `-type f` - список обычных файлов.
- `-print` - вывести список всех файлов, прошедших критерий поиска (В нашем
случае, только `-type f`).
- `> ~/files_list.txt` - перевести весь вывод команды в файл `files_list.txt`,
лежащий в домашнем каталоге (`$HOME` или `~`).

2. Чтобы вывести размер файла мы можем использовать действие `-printf`, команда
аналогичная функции из языка Си.

```bash
 find . -type f -printf "%10s\t%p" > ~/files_list.txt
```

- `%s` - печать размера файла, `%10s` сделать так, чтобы размер занимал как
минимум 10 символов. Так файл с размерами будет выровнен и более читаем.
- `\t` - Горизонтальная табуляция (`Tab`).
- `%p` - полный путь до файла (от текущей точки).
- `\n` - переход на следующую строку.

3. И наконец, используем функцию `-exec`, чтобы посчитать контрольную сумму
файла:

```bash
 find . -type f -printf "%10s\t" -exec md5sum '{}' \; | tee ~/files_list.txt
```

- `-printf "%10s\t"` - выводим только размер файла и табуляцию, а остальное выведет
команда `md5sum`;
- `-exec md5sum` - вызвать Shell-команду `md5sum`. Все следующие аргументы команды
`find` будут переданы команде `md5sum`.
- `'{}'` - Сюда команда `find` подставит имя текущего файла.
- `\;` - завершить команду `-exec`. **Обратите внимание**, что мы экранируем `;`,
чтобы она не интерпретировалась оболочкой, а передалась как аргумент в `find`
- `| tee ~/files_list.txt` - команда `tee` может дублировать поток вывода в
файл. Таким образом, мы будем видеть, контрольные суммы каких файлов сейчас
считаются на терминале, при этом весь результат будет также записан в файл
`~/files_list.txt`.

## Поиск схожих файлов в резервной копии на Предыдущем жестком диске

